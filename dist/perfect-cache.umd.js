(function(y,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(y=typeof globalThis<"u"?globalThis:y||self,g(y.PerfectCache={}))})(this,function(y){"use strict";var ce=Object.defineProperty;var ue=(y,g,R)=>g in y?ce(y,g,{enumerable:!0,configurable:!0,writable:!0,value:R}):y[g]=R;var p=(y,g,R)=>ue(y,typeof g!="symbol"?g+"":g,R);const g={driver:"memory",prefix:"cache:"};function R(n){return{all:n=n||new Map,on:function(s,e){var t=n.get(s);t?t.push(e):n.set(s,[e])},off:function(s,e){var t=n.get(s);t&&(e?t.splice(t.indexOf(e)>>>0,1):n.set(s,[]))},emit:function(s,e){var t=n.get(s);t&&t.slice().map(function(r){r(e)}),(t=n.get("*"))&&t.slice().map(function(r){r(s,e)})}}}class I{constructor(){p(this,"mitt");this.mitt=R()}$on(s,e){return this.mitt.on(s,e)}$off(s,e){return this.mitt.off(s,e)}$emit(s,e){return this.mitt.emit(s,e)}}const E={OK:Symbol("OK"),KEY_NOT_EXISTS:Symbol("KEY_NOT_EXISTS"),KEY_EXPIRED:Symbol("KEY_EXPIRED"),JSON_PARSE_ERROR:Symbol("JSON_PARSE_ERROR"),NX_SET_NOT_PERFORMED:Symbol("NX_SET_NOT_PERFORMED"),XX_SET_NOT_PERFORMED:Symbol("XX_SET_NOT_PERFORMED")};class S extends I{constructor(e){super();p(this,"opts");p(this,"isReady",!1);p(this,"prefix","cache:");this.opts=e,this.opts.prefix&&(this.prefix=this.opts.prefix),this.isReady=!1}__getRealKey(e){return`${this.prefix}${e}`}ready(e){setTimeout(()=>{this.isReady=!0,this.$emit("ready"),e&&typeof e=="function"&&e()},0)}async clear(){const e=await this.keys();for(const t of e)await this.removeItem(t);return Promise.resolve(e.length)}length(){return new Promise((e,t)=>{this.keys().then(r=>{e(r.length)}).catch(r=>{t(r)})})}getItem(e){return new Promise((t,r)=>{this.keyValueGet(e).then(o=>{o?o.expiredTimeAt?o.expiredTimeAt>Date.now()?o.maxAge?(o.expiredTimeAt=Date.now()+o.maxAge,this.keyValueSet(e,o).then(()=>t(o.value)).catch(i=>{r(i)})):t(o.value):(this.$emit("cacheExpired",e),t(void 0)):t(o.value):t(void 0)}).catch(o=>{r(o)})})}setItem(e,t,r={}){const{expiredTime:o,expiredTimeAt:i,maxAge:d,setOnlyNotExist:l=!1,setOnlyExist:m=!1}=r;let c,a;return o&&typeof o=="number"&&o>0&&(c=Date.now()+o),i&&typeof i=="number"&&i>0&&(c=i),c?c=Math.max(c,Date.now()):d&&typeof d=="number"&&d>0&&(c=Date.now()+d,a=d),new Promise((u,h)=>{l||m?this.existsKey(e).then(f=>{if(l&&f)return u(E.NX_SET_NOT_PERFORMED);if(m&&!f)return u(E.XX_SET_NOT_PERFORMED);this.keyValueSet(e,{value:t,expiredTimeAt:c,maxAge:a}).then(()=>u(E.OK)).catch(F=>{h(F)})}).catch(f=>{h(f)}):this.keyValueSet(e,{value:t,expiredTimeAt:c,maxAge:a}).then(()=>u(E.OK)).catch(f=>{h(f)})})}}p(S,"driver");class B extends S{constructor(s){super(s),this.ready()}keyValueGet(s){const e=localStorage.getItem(this.__getRealKey(s));if(e)try{const t=JSON.parse(e);return Promise.resolve(t)}catch{return v(`get key ${s} json parse error`,e),Promise.resolve(void 0)}else return Promise.resolve(void 0)}keyValueSet(s,e){try{return localStorage.setItem(this.__getRealKey(s),JSON.stringify(e)),Promise.resolve()}catch(t){return v(`set key ${s} json stringify error`,t),Promise.reject(t)}}existsKey(s){return localStorage.getItem(this.__getRealKey(s))?Promise.resolve(!0):Promise.resolve(!1)}removeItem(s){return localStorage.removeItem(this.__getRealKey(s)),Promise.resolve()}keys(){const s=[];for(const e of Object.keys(localStorage))e.startsWith(this.prefix)&&s.push(e.replace(this.prefix,""));return Promise.resolve(s)}}p(B,"driver","localStorage");class M extends S{constructor(e){super(e);p(this,"data",new Map);this.ready()}keyValueGet(e){const t=this.data.get(this.__getRealKey(e));if(t)try{const r=JSON.parse(t);return Promise.resolve(r)}catch{return v(`get key ${e} json parse error`,t),Promise.resolve(void 0)}else return Promise.resolve(void 0)}keyValueSet(e,t){try{return this.data.set(this.__getRealKey(e),JSON.stringify(t)),Promise.resolve()}catch(r){return v(`set key ${e} json stringify error`,r),Promise.reject(r)}}existsKey(e){return this.data.has(this.__getRealKey(e))?Promise.resolve(!0):Promise.resolve(!1)}removeItem(e){return this.data.delete(this.__getRealKey(e)),Promise.resolve()}keys(){const e=Array.from(this.data.keys()).map(t=>t.replace(this.prefix,""));return Promise.resolve(e)}clear(){const e=this.data.size;return this.data.clear(),Promise.resolve(e)}length(){return Promise.resolve(this.data.size)}}p(M,"driver","memory");class L extends S{constructor(s){super(s),this.ready()}keyValueGet(s){const e=sessionStorage.getItem(this.__getRealKey(s));return new Promise(t=>{if(e)try{const r=JSON.parse(e);t(r)}catch{v(`get key ${s} json parse error`,e),t(void 0)}else t(void 0)})}keyValueSet(s,e){return new Promise((t,r)=>{try{sessionStorage.setItem(this.__getRealKey(s),JSON.stringify(e)),t()}catch(o){v(`set key ${s} json stringify error`,o),r(o)}})}existsKey(s){return sessionStorage.getItem(this.__getRealKey(s))?Promise.resolve(!0):Promise.resolve(!1)}removeItem(s){return sessionStorage.removeItem(this.__getRealKey(s)),Promise.resolve()}keys(){const s=[];for(const e of Object.keys(sessionStorage))e.startsWith(this.prefix)&&s.push(e.replace(this.prefix,""));return Promise.resolve(s)}}p(L,"driver","sessionStorage");/*! js-cookie v3.0.5 | MIT */function P(n){for(var s=1;s<arguments.length;s++){var e=arguments[s];for(var t in e)n[t]=e[t]}return n}var Y={read:function(n){return n[0]==='"'&&(n=n.slice(1,-1)),n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(n){return encodeURIComponent(n).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function $(n,s){function e(r,o,i){if(!(typeof document>"u")){i=P({},s,i),typeof i.expires=="number"&&(i.expires=new Date(Date.now()+i.expires*864e5)),i.expires&&(i.expires=i.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var d="";for(var l in i)i[l]&&(d+="; "+l,i[l]!==!0&&(d+="="+i[l].split(";")[0]));return document.cookie=r+"="+n.write(o,r)+d}}function t(r){if(!(typeof document>"u"||arguments.length&&!r)){for(var o=document.cookie?document.cookie.split("; "):[],i={},d=0;d<o.length;d++){var l=o[d].split("="),m=l.slice(1).join("=");try{var c=decodeURIComponent(l[0]);if(i[c]=n.read(m,c),r===c)break}catch{}}return r?i[r]:i}}return Object.create({set:e,get:t,remove:function(r,o){e(r,"",P({},o,{expires:-1}))},withAttributes:function(r){return $(this.converter,P({},this.attributes,r))},withConverter:function(r){return $(P({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(s)},converter:{value:Object.freeze(n)}})}var k=$(Y,{path:"/"});class J extends S{constructor(s){super(s),this.ready()}keyValueGet(s){const e=k.get(this.__getRealKey(s));return new Promise(t=>{if(e)try{const r=JSON.parse(e);t(r)}catch{v(`get key ${s} json parse error`,e),t(void 0)}else t(void 0)})}keyValueSet(s,e){return new Promise((t,r)=>{try{k.set(this.__getRealKey(s),JSON.stringify(e)),t()}catch(o){r(o)}})}existsKey(s){return k.get(this.__getRealKey(s))?Promise.resolve(!0):Promise.resolve(!1)}removeItem(s){return new Promise((e,t)=>{try{k.remove(this.__getRealKey(s)),e()}catch(r){t(r)}})}keys(){const s=k.get(),e=[];for(const t of Object.keys(s))t.startsWith(this.prefix)&&e.push(t.replace(this.prefix,""));return Promise.resolve(e)}}p(J,"driver","cookie");class X extends S{constructor(e){var t,r,o,i;super(e);p(this,"dbName","perfect-cache");p(this,"objectStoreName","perfect-cache");p(this,"dbVersion");p(this,"dbConnection");(t=this.opts)!=null&&t.dbName&&(this.dbName=this.opts.dbName),(r=this.opts)!=null&&r.objectStoreName&&(this.objectStoreName=this.opts.objectStoreName),(o=this.opts)!=null&&o.dbVersion&&(this.dbVersion=this.opts.dbVersion),(i=this.opts)!=null&&i.dbConnection&&(this.dbConnection=this.opts.dbConnection),this.dbConnection?(this.dbVersion=this.dbConnection.version,this.ready()):this.connectToVersion(this.dbVersion)}init(){return this.connectDB().then(()=>this.initObjectStore())}connectToVersion(e){this.dbVersion=e,w(`Database ${this.dbName} is connecting to version ${this.dbVersion||"latest"} and store ${this.objectStoreName} will be created if not exists.`),this.init().then(()=>{w(`Database ${this.dbName} is connected to ${this.dbVersion} success and store ${this.objectStoreName} is ready.`),this.ready()}).catch(t=>{this.dbConnection?(window.console.error(`Database ${this.dbName} is connected to ${this.dbConnection.version} success but store ${this.objectStoreName} init failed because of the outdated version. now reconnect to the next version ${this.dbConnection.version+1}`,t),this.connectToVersion(this.dbConnection.version+1)):(window.console.error(`Database ${this.dbName} is connected to ${this.dbVersion||"latest"} failed and store ${this.objectStoreName} is not ready because of the outdated version. now reconnect to the latest version`,t),this.connectToVersion())})}waitForConnectionReady(e,t={}){const{timeout:r,interval:o=100,readyLog:i=!1}=t;this.isReady&&this.dbConnection?(i&&w(`Database connection ${this.dbName} is connected and store ${this.objectStoreName} is ready.(^v^)`),e&&typeof e=="function"&&e()):(w(`Waiting for the database connection ${this.dbName} store ${this.objectStoreName} ready...`),r&&r>0||r===void 0?window.setTimeout(()=>{this.waitForConnectionReady(e,{timeout:r?r-o:void 0,interval:o,readyLog:!0})},o):e&&typeof e=="function"&&e(new Error(`Waiting for the database connection ${this.dbName} store ${this.objectStoreName} ready timeout.`)))}connectDB(){return this.dbConnection&&(this.dbConnection.close(),this.dbConnection.onversionchange=null,this.dbConnection=void 0,this.isReady=!1),G(this.dbName,this.dbVersion).then(e=>{this.dbConnection=e,this.dbVersion=e.version,e.onversionchange=t=>{w(`The version of this database ${this.dbName} store ${this.objectStoreName} has changed from ${t.oldVersion} to ${t.newVersion}`),this.connectToVersion(t.newVersion||void 0)}})}initObjectStore(){return new Promise((e,t)=>{if(this.dbConnection)if(this.dbConnection.objectStoreNames.contains(this.objectStoreName))e(void 0);else{w(`ObjectStore ${this.objectStoreName} is not exists, now creating it!`);const r=this.dbConnection.createObjectStore(this.objectStoreName,{keyPath:"key"});r.transaction.oncomplete=o=>{w(`ObjectStore ${this.objectStoreName} is created now.`),e(r)}}else{const r=new Error(`Database ${this.dbName} connection is not initialised.`);t(r)}})}keyValueGet(e){return new Promise((t,r)=>{this.waitForConnectionReady(o=>{if(o)r(o);else{const i=this.dbConnection.transaction([this.objectStoreName],"readonly").objectStore(this.objectStoreName).get(this.__getRealKey(e));i.onerror=()=>{window.console.error("Database get occurs error",i.result),r(i.result)},i.onsuccess=()=>{var d;t((d=i.result)==null?void 0:d.value)}}})})}keyValueSet(e,t){return new Promise((r,o)=>{this.waitForConnectionReady(i=>{if(i)o(i);else{const d=this.dbConnection.transaction([this.objectStoreName],"readwrite").objectStore(this.objectStoreName).put({key:this.__getRealKey(e),value:t});d.onerror=()=>{window.console.error("Database put occurs error",d.result),o(d.result)},d.onsuccess=()=>{r()}}})})}existsKey(e){return new Promise((t,r)=>{this.waitForConnectionReady(o=>{if(o)r(o);else{const i=this.dbConnection.transaction([this.objectStoreName],"readonly").objectStore(this.objectStoreName).count(this.__getRealKey(e));i.onerror=()=>{window.console.error("Database count occurs error",i.result),r(i.result)},i.onsuccess=()=>{t(!!i.result)}}})})}removeItem(e){return new Promise((t,r)=>{this.waitForConnectionReady(o=>{if(o)r(o);else{const i=this.dbConnection.transaction([this.objectStoreName],"readwrite").objectStore(this.objectStoreName).delete(this.__getRealKey(e));i.onerror=()=>{window.console.error("Database delete occurs error",i.result),r(i.result)},i.onsuccess=()=>{t()}}})})}keys(){const e=[];return new Promise((t,r)=>{this.waitForConnectionReady(o=>{if(o)r(o);else{const i=this.dbConnection.transaction([this.objectStoreName],"readonly").objectStore(this.objectStoreName).openCursor();i.onerror=()=>{window.console.error("Database openCursor occurs error",i.result),r(i.result)},i.onsuccess=d=>{const l=i.result;l?(l.key.startsWith(this.prefix)&&e.push(l.key.replace(this.prefix,"")),l.continue()):t(e)}}})})}}p(X,"driver","indexedDB");const x={};for(const n of[M,B,L,J,X])Object.assign(x,{[n.driver]:n});const j={};function Z(n){if(n.driver&&typeof n.driver=="string")j[n.driver]=n;else throw new Error("please input the driver name.");if(n instanceof S.constructor)if(n.driver&&typeof n.driver=="string")j[n.driver]=n;else throw new Error("please input the driver name.");else throw new Error("the store driver class must be subclass of BaseStore.")}function H(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var D={exports:{}},T,q;function Q(){if(q)return T;q=1;var n=1e3,s=n*60,e=s*60,t=e*24,r=t*7,o=t*365.25;T=function(c,a){a=a||{};var u=typeof c;if(u==="string"&&c.length>0)return i(c);if(u==="number"&&isFinite(c))return a.long?l(c):d(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function i(c){if(c=String(c),!(c.length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(a){var u=parseFloat(a[1]),h=(a[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return u*o;case"weeks":case"week":case"w":return u*r;case"days":case"day":case"d":return u*t;case"hours":case"hour":case"hrs":case"hr":case"h":return u*e;case"minutes":case"minute":case"mins":case"min":case"m":return u*s;case"seconds":case"second":case"secs":case"sec":case"s":return u*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}}}function d(c){var a=Math.abs(c);return a>=t?Math.round(c/t)+"d":a>=e?Math.round(c/e)+"h":a>=s?Math.round(c/s)+"m":a>=n?Math.round(c/n)+"s":c+"ms"}function l(c){var a=Math.abs(c);return a>=t?m(c,a,t,"day"):a>=e?m(c,a,e,"hour"):a>=s?m(c,a,s,"minute"):a>=n?m(c,a,n,"second"):c+" ms"}function m(c,a,u,h){var f=a>=u*1.5;return Math.round(c/u)+" "+h+(f?"s":"")}return T}var A,z;function ee(){if(z)return A;z=1;function n(s){t.debug=t,t.default=t,t.coerce=m,t.disable=d,t.enable=o,t.enabled=l,t.humanize=Q(),t.destroy=c,Object.keys(s).forEach(a=>{t[a]=s[a]}),t.names=[],t.skips=[],t.formatters={};function e(a){let u=0;for(let h=0;h<a.length;h++)u=(u<<5)-u+a.charCodeAt(h),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=e;function t(a){let u,h=null,f,F;function C(...b){if(!C.enabled)return;const _=C,N=Number(new Date),ne=N-(u||N);_.diff=ne,_.prev=u,_.curr=N,u=N,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let O=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(V,ie)=>{if(V==="%%")return"%";O++;const W=t.formatters[ie];if(typeof W=="function"){const ae=b[O];V=W.call(_,ae),b.splice(O,1),O--}return V}),t.formatArgs.call(_,b),(_.log||t.log).apply(_,b)}return C.namespace=a,C.useColors=t.useColors(),C.color=t.selectColor(a),C.extend=r,C.destroy=t.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(f!==t.namespaces&&(f=t.namespaces,F=t.enabled(a)),F),set:b=>{h=b}}),typeof t.init=="function"&&t.init(C),C}function r(a,u){const h=t(this.namespace+(typeof u>"u"?":":u)+a);return h.log=this.log,h}function o(a){t.save(a),t.namespaces=a,t.names=[],t.skips=[];const u=(typeof a=="string"?a:"").trim().replace(" ",",").split(",").filter(Boolean);for(const h of u)h[0]==="-"?t.skips.push(h.slice(1)):t.names.push(h)}function i(a,u){let h=0,f=0,F=-1,C=0;for(;h<a.length;)if(f<u.length&&(u[f]===a[h]||u[f]==="*"))u[f]==="*"?(F=f,C=h,f++):(h++,f++);else if(F!==-1)f=F+1,C++,h=C;else return!1;for(;f<u.length&&u[f]==="*";)f++;return f===u.length}function d(){const a=[...t.names,...t.skips.map(u=>"-"+u)].join(",");return t.enable(""),a}function l(a){for(const u of t.skips)if(i(a,u))return!1;for(const u of t.names)if(i(a,u))return!0;return!1}function m(a){return a instanceof Error?a.stack||a.message:a}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}return A=n,A}var U;function te(){return U||(U=1,function(n,s){s.formatArgs=t,s.save=r,s.load=o,s.useColors=e,s.storage=i(),s.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),s.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function t(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const m="color: "+this.color;l.splice(1,0,m,"color: inherit");let c=0,a=0;l[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&(c++,u==="%c"&&(a=c))}),l.splice(a,0,m)}s.log=console.debug||console.log||(()=>{});function r(l){try{l?s.storage.setItem("debug",l):s.storage.removeItem("debug")}catch{}}function o(){let l;try{l=s.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=process.env.DEBUG),l}function i(){try{return localStorage}catch{}}n.exports=ee()(s);const{formatters:d}=n.exports;d.j=function(l){try{return JSON.stringify(l)}catch(m){return"[UnexpectedJSONParseError]: "+m.message}}}(D,D.exports)),D.exports}var re=te();const v=H(re)("perfect-cache"),w=v.extend("indexedDB"),K=()=>{let n=["memory"];return typeof window<"u"&&(window!=null&&window.localStorage)&&x.localStorage&&n.push("localStorage"),typeof window<"u"&&(window!=null&&window.sessionStorage)&&x.sessionStorage&&n.push("sessionStorage"),typeof window<"u"&&(window!=null&&window.document)&&"cookie"in window.document&&x.cookie&&n.push("cookie"),typeof window<"u"&&(window!=null&&window.indexedDB)&&x.indexedDB&&n.push("indexedDB"),n=n.concat(Object.keys(j)),n},se=n=>n in x?x[n]:j[n],G=(n,s)=>new Promise((e,t)=>{const r=window.indexedDB.open(n,s);r.onerror=o=>{console.error(`Database ${n} version ${s||"latest"} initialised error.`,o),t(o)},r.onsuccess=()=>{const o=r.result,i=o.version;w(`Database ${n} version ${i} initialised success.`),e(o)},r.onupgradeneeded=o=>{const i=r.result;w(`Database ${n} upgrade needed as oldVersion is ${o.oldVersion} and newVersion is ${o.newVersion}.`),e(i)}});class oe extends I{constructor(e,t){super();p(this,"opts");p(this,"__init",!1);p(this,"driver");p(this,"store");p(this,"keyFallbacks",[]);p(this,"keyRegexFallbacks",[]);const r=K();let o;if(!e&&!t)o={...g};else if(e)if(typeof e=="string"&&r.includes(e))Object.prototype.toString.call(t)==="[object Object]"?o={...g,driver:e,...t}:o={...g,driver:e};else if(typeof e!="string"&&Object.prototype.toString.call(e)==="[object Object]"&&r.includes(e.driver))o={...g,...e};else throw new Error("please input the correct driver param as the first param or in the opts params.");else throw new Error("please input the driver as first param.");if(o&&o.driver)this.opts=o,this.initDriver();else throw new Error("please input the driver as first param.")}initDriver(){const e=K();if(this.opts&&this.opts.driver&&e.includes(this.opts.driver)){this.__init=!1;const t=se(this.opts.driver);this.store=new t(this.opts),this.store.$on("ready",()=>{this.__init=!0,this.driver=this.opts.driver,this.$emit("ready")}),this.store.$on("cacheExpired",r=>{this.$emit("cacheExpired",r)})}}setDriver(e){this.opts.driver=e,this.initDriver()}existsKey(...e){return this.store.existsKey(...e)}async getItem(e,t={}){const{defaultVal:r,withFallback:o=!0,refreshCache:i=!0}=t,d=await this.store.getItem(e),l=d==null||d==="";if(l&&o){const m=this.__getFallbackByKey(e);if(m){const c=await m.fallback(e),a=c==null||c==="";return i&&!a&&await this.store.setItem(e,c,{expiredTime:m.expiredTime,maxAge:m.maxAge}),a&&r!==void 0?r:c}else return r===void 0?d:r}else return l&&r!==void 0?r:d}setItem(...e){return this.store.setItem(...e)}removeItem(...e){return this.store.removeItem(...e)}clear(){return this.store.clear()}keys(){return this.store.keys()}length(){return this.store.length()}async getItemList(e,t){let r=[];const o={};Array.isArray(e)?r=e:e instanceof RegExp?r=(await this.keys()).filter(i=>e.test(i)):r=[];for(const i of r){const d=await this.getItem(i,t);o[i]=d}return o}async removeItemList(e){let t=[];Array.isArray(e)?t=e:e instanceof RegExp?t=(await this.keys()).filter(r=>e.test(r)):t=[];for(const r of t)await this.removeItem(r)}fallbackKey(e,t,r={}){const{expiredTime:o,maxAge:i}=r;if(typeof e=="string"){if(t instanceof Function)return this.keyFallbacks.push({key:e,expiredTime:o,maxAge:i,fallback:t});throw new Error("please input the fallback as type [Function]")}if(e instanceof RegExp){if(t instanceof Function)return this.keyRegexFallbacks.push({regex:e,expiredTime:o,maxAge:i,fallback:t});throw new Error("please input the fallback as type [Function]")}}__getFallbackByKey(e){let t;return t=this.keyFallbacks.find(r=>r.key===e),t||(t=this.keyRegexFallbacks.find(r=>r.regex.test(e)),t)}}y.BaseStore=S,y.EventListener=I,y.PerfectCache=oe,y.StoreResult=E,y.cacheDebugger=v,y.connectToIndexedDB=G,y.getSupportedDriverList=K,y.indexedDBDebugger=w,y.registerStore=Z,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
